# Plan: Decompose splurge-tools into standalone libraries

Date: 2025-09-05

## Requirements
- Follow Research, Plan, Implement lifecycle.
- Each new library is standalone, reusable, and versioned.
- Provide transitional shims in `splurge_tools` with `DeprecationWarning`.
- Maintain test parity; port unit tests; keep e2e in `splurge-tools` temporarily.
 

## Package map and dependency layering
- splurge-core: `common_utils.py`, `exceptions.py`
  - Depends on: stdlib only
- splurge-protocols: `protocols.py`
  - Depends on: splurge-core
- splurge-validate: `data_validator.py`, `path_validator.py`
  - Depends on: splurge-core, splurge-protocols
- splurge-transform: `data_transformer.py`
  - Depends on: splurge-core
- splurge-text: `text_normalizer.py`, `string_tokenizer.py`, `case_helper.py`
  - Depends on: splurge-core, splurge-validate (optionally)
- splurge-io: `text_file_helper.py`, `resource_manager.py`
  - Depends on: splurge-core
- splurge-tabular-core: `tabular_data_model.py`, `tabular_utils.py`
  - Depends on: splurge-core, splurge-validate, splurge-transform
- splurge-tabular-typed: `typed_tabular_data_model.py`
  - Depends on: splurge-tabular-core, splurge-protocols
- splurge-tabular-streaming: `streaming_tabular_data_model.py`
  - Depends on: splurge-tabular-core
- splurge-random: `random_helper.py`
  - Depends on: stdlib only
- splurge-decorators: `decorators.py`
  - Depends on: stdlib only
- splurge-factory: `factory.py`
  - Depends on: splurge-core
- Already externalized: `splurge-dsv` (`dsv_helper.py`, `exceptions.py`, `path_validator.py`, `resource_manager.py`, `string_tokenizer.py`, `text_file_helper.py`), `splurge-base58` (`base58.py`), `splurge-typer` (type inference and typing helpers: `data_type.py`, `duck_typing.py`, `string.py`, `type_inference.py`)

Dependency layering rule of thumb:
- core → protocols/validate/transform/text/io → tabular-core → tabular-typed/streaming
- dsv, base58, typer remain independent and optional integrations for tabular.

## Phased migration plan

Phase 0 — Repo strategy and scaffolding
- Choose monorepo with `packages/*` for velocity. Publish to PyPI individually.
- Create shared CI templates for build, test, publish.

Phase 1 — Extract leaf packages
- Create: splurge-random, splurge-decorators, splurge-factory, splurge-text, splurge-io.
- Move files, port unit tests.
- Release v0.x for each; integrate into `splurge_tools` via re-exports + warnings.

Phase 2 — Core foundations
- Create: splurge-core, splurge-protocols, splurge-validate, splurge-transform.
- Refactor imports in dependent packages to use new foundations.
- Release v0.x; update shims.

Phase 3 — Tabular stack
- Create: splurge-tabular-core, splurge-tabular-typed, splurge-tabular-streaming.
- Port relevant unit tests and e2e coverage; ensure performance parity.

Phase 4 — Deprecation and removal
- One minor release of `splurge_tools` with warnings across all re-exports.
- Next major: remove shims; README points to new packages.

## Transitional shims
- In `splurge_tools/<module>.py` replace implementations with re-exports, e.g.:
  - Import from new package and assign names; emit `DeprecationWarning` on import.
- Keep function/class names identical to minimize user pain.

## Test strategy (TDD + BDD)
- TDD: port unit tests first; if gaps exist, write tests before moving code.
- Keep existing e2e tests in `tests/e2e` pointing to `splurge_tools` shims during transition.
- Add smoke tests that import from both new packages and `splurge_tools` shims.

## Acceptance criteria per package
- 100% of moved unit tests pass.
- API parity validated by shim tests and import paths.
- No dependency cycles; import graph respects layering.

## Rollback plan
- If a package causes regressions, pin `splurge_tools` to previous version and revert shim to internal implementation until fixed.

## Timeline (suggested)
- Phase 1: 1–2 days
- Phase 2: 1–2 days
- Phase 3: 2–3 days
- Phase 4: 0.5 day

## Notes
- `splurge-typer` currently has no CLI; do not introduce dependencies from core libs onto it. If shared type helpers are required elsewhere, consider a neutral, tiny `splurge-type-helpers` later, or vendor minimal functions to avoid coupling.
